<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="pragma" content="no-cache" />
    <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
    <title>ASPTT Grand Toulouse Natation - Adhérents</title>
    <link rel="stylesheet" href="css/adherents.css" type="text/css" />
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/start/jquery-ui.css" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script type="text/javascript" src="js/ckeditor/ckeditor.js"></script>
<script type="text/javascript" src="js/ckeditor/adapters/jquery.js"></script>
    
    <style>
  #dialog label, #dialog input { display:block; }
  #dialog label { margin-top: 0.5em; }
  #dialog input, #dialog textarea { width: 95%; }
  </style>
  
  <script>
  $(function() {
	$("#search").button();
	$("#nom").keypress(function(e) {
	    if (e.keyCode == $.ui.keyCode.ENTER) {
	          doSearch();
	    }
	});
	$("#search").click(function() {
	  doSearch();
	});
	
	$("#sendEmail").button();
	$("#sendEmail").click(function() {
		$("#sendEmailPopup").dialog("open");
		$('#corps').ckeditor();
	});
	
	$("#sendEmailSend").button();
	$("#sendEmailSend").click(function() {
		$.ajax({
		  type:"POST",
		  url:"adherentList.do?action=sendEmail",
		  data: $("#formSendEmail").serialize() + "&" + $("#formResult").serialize(),
		  dataType: "text", 
		  success: function(data){
			  $("#sendEmailPopup").dialog("close");
			  alert("L'e-mail a été envoyé à " + data + " adhérent(s) avec succès");
		   },
           error: function(){
        	   $("#sendEmailPopup").dialog("close");
				alert('Une erreur est survenue.');
			}
		});
	});
	
	$("#affecterAction").button();
	$("#affecterAction").click(function() {
		$.ajax({
		  type:"POST",
		  data: $("#formAffecter").serialize(),
		  url:"adherentList.do?action=affecter",
		  dataType: "text", 
		  success: function(data){
			  $("#affecterPopup").dialog("close");
			  alert("L'adhérent a été affecté avec succès");
		   },
           error: function(){
        	   $("#affecterPopup").dialog("close");
				alert('Une erreur est survenue.');
			}
		});
	});
	
	
	$( "#loading" ).dialog({
	      height: 140,
	      modal: true,
	      autoOpen: false,
	      dialogClass: 'loading-dialog'	
	    });
	$( "#sendEmailPopup" ).dialog({
	      height: 600,
	      width: 800,
	      modal: true,
	      autoOpen: false
	    });
	
	$( "#affecterPopup" ).dialog({
	      height: 400,
	      width: 600,
	      modal: true,
	      autoOpen: false
	    });
	
	$( "#infoPopup" ).dialog({
	      height: 600,
	      width: 800,
	      modal: true,
	      autoOpen: false
	    });

	$( document ).ajaxSend(function() {
		$("#loading").dialog("open");
	});
	$( document ).ajaxComplete(function() {
		$("#loading").dialog("close");
	});
	getGroupes();
	getPiscines();
	
	$("#selectAll").click(function() {
		var checkedStatus = this.checked;
		$("input[name='selections']").each(function () {
			$(this).attr('checked', checkedStatus);
		});
	});
  });
  
  function openAffecterPopup(adherentId) {
	  $("#affecterAdherent").val("" + adherentId);
	  $("#affecterPopup").dialog("open");
		getGroupesAffecter();
  }
  
  function openInfoPopup(adherentId) {
	  $("#infoPopup").dialog("open");
	  $.ajax({
          type: "POST",
          url: "adherentList.do?action=loadAdherent&selectedAdherent=" + adherentId,
          dataType: "json",
          success: function(data){
       		var div = $("#info-data");
       		div.empty();
       		var etatCivileDiv = $("<div class=\"info-set\"></div>");
       		etatCivileDiv.append("<p class=\"info-set-title\">Etat civil</p>");
       		etatCivileDiv.append("<p></p>").append("Civilité: <span class=\"info-value\">" + data.civilite + "</span>");
       		etatCivileDiv.append("<p></p>").append("Nom: <span id=\"" + data.id + "_nom\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'nom', '" + data.nom + "')\">" + data.nom + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_nom_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'nom', '" + data.nom + "')\" title=\"Modifier le nom\" />");
       		etatCivileDiv.append("<p></p>").append("Prénom: <span id=\"" + data.id + "_prenom\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'prenom', '" + data.prenom + "')\">" + data.prenom + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_prenom_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'prenom', '" + data.prenom + "')\" title=\"Modifier le prénom\" />");
       		etatCivileDiv.append("<p></p>").append("Date de naissance: <span id=\"" + data.id + "_datenaissance\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'datenaissance', '" + data.datenaissance + "')\">" + data.datenaissance + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_datenaissance_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'datenaissance', '" + data.datenaissance + "')\" title=\"Modifier la date de naissance\" />");
       		div.append(etatCivileDiv);
       		
       		var adresseDiv = $("<div class=\"info-set\"></div>");
       		adresseDiv.append("<p class=\"info-set-title\">Adresse</p>");
       		adresseDiv.append("<p></p>").append("Adresse postale: <span id=\"" + data.id + "_adresse\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'adresse', '" + data.adresse + "')\">" + data.adresse + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_adresse_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'adresse', '" + data.adresse + "')\" title=\"Modifier l'adresse\" />");
       		adresseDiv.append("<p></p>").append("Code postal: <span id=\"" + data.id + "_codepostal\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'codepostal', '" + data.codepostal + "')\">" + data.codepostal + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_codepostal_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'codepostal', '" + data.codepostal + "')\" title=\"Modifier le code postal\" />");
       		adresseDiv.append("<p></p>").append("Ville: <span id=\"" + data.id + "_ville\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'ville', '" + data.ville + "')\">" + data.ville + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_ville_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'ville', '" + data.ville + "')\" title=\"Modifier la ville\" />");
       		div.append(adresseDiv);
       		
       		var contactDiv = $("<div class=\"info-set\"></div>");
       		contactDiv.append("<p class=\"info-set-title\">Contact</p>");
       		contactDiv.append("<p></p>").append("Téléphone: <span id=\"" + data.id + "_telephone\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'telephone', '" + data.telephone + "')\">" + data.telephone + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_telephone_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'telephone', '" + data.telephone + "')\" title=\"Modifier le téléphone\" />");
       		contactDiv.append("<p></p>").append("Téléphone (père): <span id=\"" + data.id + "telephonePere\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'telephonePere', '" + data.telephonePere + "')\">" + data.telephonePere + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_telephonePere_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'telephonePere', '" + data.telephonePere + "')\" title=\"Modifier le téléphone du père\" />");
       		contactDiv.append("<p></p>").append("Téléphone pro (père): <span id=\"" + data.id + "_telephonePerePro\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'telephonePerePro', '" + data.telephonePerePro + "')\">" + data.telephonePerePro + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_telephonePerePro_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'telephonePerePro', '" + data.telephonePerePro + "')\" title=\"Modifier le téléphone pro du père\" />");
       		contactDiv.append("<p></p>").append("Téléphone (mère): <span id=\"" + data.id + "_telephoneMere\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'telephoneMere', '" + data.telephoneMere + "')\">" + data.telephoneMere + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_telephoneMere_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'telephoneMere', '" + data.telephoneMere + "')\" title=\"Modifier le téléphone de la mère\" />");
       		contactDiv.append("<p></p>").append("Téléphone pro (mère): <span id=\"" + data.id + "_telephoneMerePro\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'telephoneMerePro', '" + data.telephoneMerePro + "')\">" + data.telephoneMerePro + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_telephoneMerePro_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'telephoneMerePro', '" + data.telephoneMerePro + "')\" title=\"Modifier le téléphone pro de la mère\" />");
       		contactDiv.append("<p></p>").append("E-mail: <span id=\"" + data.id + "_email\" class=\"info-value\" onclick=\"edit(" + data.id + ",'email', '" + data.email + "')\">" + data.email + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_email_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'email', '" + data.email + "')\" title=\"Modifier l'adresse e-mail\" />");
       		div.append(contactDiv);
       		
       		var equipementDiv = $("<div class=\"info-set\"></div>");
       		equipementDiv.append("<p class=\"info-set-title\">Equipement - mensuration</p>");
       		equipementDiv.append("<p></p>").append("Maillot: <span id=\"" + data.id + "_maillot\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'maillot', '" + data.maillot + "')\">" + data.maillot + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_maillot_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'maillot', '" + data.maillot + "')\" title=\"Modifier la taille du maillot\" />");
       		equipementDiv.append("<p></p>").append("T-shirt: <span id=\"" + data.id + "_tshirt\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'tshirt', '" + data.tshirt + "')\">" + data.tshirt + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_tshirt_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'tshirt', '" + data.tshirt + "')\" title=\"Modifier la taille du t-shirt\" />");
       		equipementDiv.append("<p></p>").append("Short - Pantalon: <span id=\"" + data.id + "_shortPantalon\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'shortPantalon', '" + data.shortPantalon + "')\">" + data.shortPantalon + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_shortPantalon_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'shortPantalon', '" + data.shortPantalon + "')\" title=\"Modifier la taille du short/pantalon\" />");
       		div.append(equipementDiv);
       		
       		var renseignementDiv = $("<div class=\"info-set\"></div>");
       		renseignementDiv.append("<p class=\"info-set-title\">Renseignements confidentiels</p>");
       		renseignementDiv.append("<p></p>").append("Profession: <span id=\"" + data.id + "_profession\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'profession', '" + data.profession + "')\">" + data.profession + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_profession_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'profession', '" + data.profession + "')\" title=\"Profession\" />");
       		renseignementDiv.append("<p></p>").append("Profession (père): <span id=\"" + data.id + "_professionTextPere\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'professionTextPere', '" + data.professionTextPere + "')\">" + data.professionTextPere + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_professionTextPere_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'professionTextPere', '" + data.professionTextPere + "')\" title=\"Profession du père\" />");
       		renseignementDiv.append("<p></p>").append("Profession (mère): <span id=\"" + data.id + "_professionTextMere\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'professionTextMere', '" + data.professionTextMere + "')\">" + data.professionTextMere + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_professionTextMere_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'professionTextMere', '" + data.professionTextMere + "')\" title=\"Profession de la mère\" />");
       		div.append(renseignementDiv);
       		
       		var accidentDiv = $("<div class=\"info-set\"></div>");
       		accidentDiv.append("<p class=\"info-set-title\">Personnes à contacter en cas d'accidentRenseignements confidentiels</p>");
       		accidentDiv.append("<p></p>").append("Nom 1: <span id=\"" + data.id + "_accidentNom1\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'accidentNom1', '" + data.accidentNom1 + "')\">" + data.accidentNom1 + "</span>&nbsp;<button type=\"button\" id=\"" + adherentId + "_accidentNom1_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'accidentNom1', '" + data.accidentNom1 + "')\" title=\"Nom du contact en cas accident (1)\" />");
       		accidentDiv.append("<p></p>").append("Prénom 1: <span id=\"" + data.id + "_accidentPrenom1\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'accidentPrenom1', '" + data.accidentPrenom1 + "')\">" + data.accidentPrenom1 + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_accidentPrenom1_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'accidentPrenom1', '" + data.accidentPrenom1 + "')\" title=\"Prénom du contact en cas accident (1)\" />");
       		accidentDiv.append("<p></p>").append("Téléphone 1: <span id=\"" + data.id + "_accidentTelephone1\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'accidentTelephone1', '" + data.accidentTelephone1 + "')\">" + data.accidentTelephone1 + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_accidentTelephone1_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'accidentTelephone1', '" + data.accidentTelephone1 + "')\" title=\"Téléphone du contact en cas accident (1)\" />");
       		accidentDiv.append("<p></p>").append("Nom 2: <span id=\"" + data.id + "_accidentNom2\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'accidentNom2', '" + data.accidentNom2 + "')\">" + data.accidentNom2 + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_accidentNom2_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'accidentNom2', '" + data.accidentNom2 + "')\" title=\"Nom du contact en cas accident (2)\" />");
       		accidentDiv.append("<p></p>").append("Prénom 2: <span id=\"" + data.id + "_accidentPrenom2\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'accidentPrenom2', '" + data.accidentPrenom2 + "')\">" + data.accidentPrenom2 + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_accidentPrenom2_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'accidentPrenom2', '" + data.accidentPrenom2 + "')\" title=\"Prénom du contact en cas accident (2)\" />");
       		accidentDiv.append("<p></p>").append("Téléphone 2: <span id=\"" + data.id + "_accidentTelephone2\" class=\"info-value\" onclick=\"edit(" + data.id + ", 'accidentTelephone2', '" + data.accidentTelephone2 + "')\">" + data.accidentTelephone2 + "</span>&nbsp; <button type=\"button\" id=\"" + adherentId + "_accidentTelephone2_edit_img\" class=\"adherent-edit\" onclick=\"edit(" + data.id + ", 'accidentTelephone2', '" + data.accidentTelephone2 + "')\" title=\"Téléphone du contact en cas accident (2)\" />");
       		div.append(accidentDiv);
          }
      });
  }
  
  function edit(adherentId, field, fieldValue) {
	  var input = $('<input type="text" id="' + adherentId + '_' + field + '_input" value="' + fieldValue + '" />&nbsp; <button type="button" id="' + adherentId + '_' + field + '_img" class="adherent-valid" onclick="doUpdate("'+adherentId+', '+field+'")" title="Sauvegarder" />');
	  $(input).blur(function() {
		  if(input.val() != fieldValue) {
			  doUpdate(adherentId, field);
		  }
		});
	  $("#" + adherentId + "_" + field).replaceWith(input);
	  $("#" + adherentId + "_" + field + "_edit_img").remove();
  }
  
  function doUpdate(adherentId, field) {
	  var input = $("#" + adherentId + "_" + field  + "_input");
	  $.ajax({
          type: "POST",
          url: "adherentList.do?action=updateAdherent&adherentId=" + adherentId + "&" + field + "=" + input.val(),
          dataType: "text",
          success: function(data) {
        	$("#" + adherentId + "_" + field  + "_img").remove();
       		input.after('<img src="img/accept.png" />');
          }
      });  
  }
  
  function getGroupes() {
		$.ajax({
          type: "POST",
          url: "adherentList.do?action=loadGroupes",
          dataType: "json",
          success: function(data){
       		var select = $("#groupe");
       		select.empty();
       		select.append('<option value="-1">Aucune sélection</option>');
       		select.append('<option value="-2">Sans groupe</option>');
           	$.each(data, function() {
           		select.append('<option value="' + this.id + '">' + this.title + '</option>');
           	});
           	select.change(function() {
       			getCreneaux($(this).val());		
       		});
          }
      });
	}
  
  function getGroupesAffecter() {
	  $("#divAffecterCreneau").hide();
		$.ajax({
        type: "POST",
        url: "adherentList.do?action=loadGroupes",
        dataType: "json",
        success: function(data){
     		var select = $("#affecterGroupe");
     		select.empty();
     		select.append('<option value="-1">Aucune sélection</option>');
         	$.each(data, function() {
         		select.append('<option value="' + this.id + '">' + this.title + '</option>');
         	});
         	select.change(function() {
     			getCreneauxAffecter($(this).val());		
     		});
        }
    });
	}
  
  function getCreneauxAffecter(groupeId) {
		$.ajax({
        type: "POST",
        url: "adherentList.do?action=loadCreneaux&selectedGroupe=" + groupeId,
        dataType: "json",
        success: function(data){
      	  	var select = $("#affecterCreneau");
    	  	select.empty();
       		select.append('<option value="-1">Aucune sélection</option>');
           	$.each(data, function() {
           		select.append('<option value="' + this.id + '">' + this.swimmingPool + " - " + this.dayOfWeek + " " + this.beginStr + " - " + this.endStr + '</option>');
           	});
           	$("#divAffecterCreneau").show();
        }
    });
	}
	
	function getCreneaux(groupeId) {
		$.ajax({
          type: "POST",
          url: "adherentList.do?action=loadCreneaux&selectedGroupe=" + groupeId,
          dataType: "json",
          success: function(data){
        	  var select = $("#creneau");
          		select.empty();
          		select.append('<option value="">Aucune sélection</option>');
          		select.append('<option value="-2">Sans créneaux</option>');
               	$.each(data, function() {
               		select.append('<option value="' + this.id + '">' + this.swimmingPool + " - " + this.dayOfWeek + " " + this.beginStr + " - " + this.endStr + '</option>');
               	});
          }
      });
	}
	
	function supprimer(id, nom, prenom) {
		if(confirm(nom + " " + prenom + " va être définitivement supprimé")) {
			$.ajax({
		          type: "POST",
		          url: "adherentList.do?action=supprimer&selectedAdherent=" + id,
		          dataType: "text",
		          success: function() {
		        	  $("#" + id).hide();
		        	  alert("Supprimé avec succès.");
		          }
		      });
		}
	}
	
	function doSearch() {
		$.ajax({
			  type:"POST",
			  data: $("#formSearch").serialize(),
			  url:"adherentList.do?action=search",
			  dataType: "json", 
			  success: function(data){
				var tbody = $("#result-table-body");
				tbody.empty();
				var index = 0;
				$.each(data, function() {
					index++;
					var entityId = this.id;
					var row = $('<tr id="'+this.id+'"></tr>');
					tbody.append(row);
					row.append('<td><input type="checkbox" name="selections" value="' + this.id + '" />&nbsp;<button type="button" class="adherent-action-edit" onclick="openInfoPopup('+this.id+')" title="Voir/Editer les informations de l\'adhérent"></button>&nbsp;<button type="button" class="adherent-action-affecter" onclick="openAffecterPopup('+this.id+')" title="Changer de groupe/créneaux"></button><button type="button" class="adherent-action-supprimer" onclick="supprimer('+this.id+',\''+this.nom+'\',\''+this.prenom+'\')" title="Supprimer l\'adhérent"></button></td>').append("<td>" + index + "</td>").append("<td>" + this.nom + "</td><td>" + this.prenom + "</td><td>" + this.dateNaissance + "</td><td>"+this.email+"</td><td>" + this.motdepasse + "</td><td>" + this.groupe + "</td>");
					var creneau = "";
					$.each(this.creneaux, function() {
						creneau = creneau + this + "<br />";
					});
					row.append("<td>" + creneau + "</td>");
				 	row.append("<td>" + this.inscriptionDt + "</td>");
				 	row.append("<td>" + this.emailPrincipal + "</td>");
				 	
				 	var checkbox = $('<input type="checkbox" value="' + this.certificat + '" />');
				 	checkbox.attr('checked', this.certificat);
				 	checkbox.change(function () {
				 		var envoi = false;
				 		if(this.checked && confirm("Envoyez un e-mail automatique ?")) {
				 			envoi = true;
				 		}
				 		$.ajax({
				 			type: "POST",
				 			url: "adherentList.do?action=updateAttribute&entity="+entityId+"&attributeValue=" + this.checked + "&attribute=certificat" + "&envoi=" + envoi,
					        dataType: "json",
					        success: function(data){
					        	
					        }
				 		});
				 	});
				 	var checkboxTd = $("<td></td>");
				 	checkboxTd.append(checkbox);
				 	row.append(checkboxTd);
				 	
				 	var checkboxPaiement = $('<input type="checkbox" value="' + this.paiement + '" />');
				 	checkboxPaiement.attr('checked', this.paiement);
				 	checkboxPaiement.click(function () {
				 		var envoi = false;
				 		if(this.checked && confirm("Envoyez un e-mail automatique ?")) {
				 			var montant = prompt("Montant manquant (chiffre uniquement)");
				 			envoi = true;
				 		}
				 		var checkedValue = false;
				 		if(this.checked) {
				 			checkedValue = true;
				 		}
				 		$.ajax({
				 			type: "POST",
					        url: "adherentList.do?action=updateAttribute&entity="+entityId+"&attribute=paiement&attributeValue=" + this.checked + "&envoi=" + envoi + "&montant=" + montant,
					        dataType: "json",
					        success: function(data){
					        	
					        }
				 		});
				 	});
				 	var checkboxPaiementTd = $("<td></td>");
				 	checkboxPaiementTd.append(checkboxPaiement);
				 	row.append(checkboxPaiementTd);
				 	
				 	var checkboxComplet = $('<input type="checkbox" value="' + this.complet + '" />');
				 	checkboxComplet.attr('checked', this.complet);
				 	checkboxComplet.click(function () {
				 		var envoi = false;
				 		if(this.checked && confirm("Envoyez un e-mail automatique ?")) {
				 			envoi = true;
				 		}
				 		var checkedValue = false;
				 		if(this.checked) {
				 			checkedValue = true;
				 		}
				 		$.ajax({
				 			type: "POST",
					        url: "adherentList.do?action=sendConfirmation&adherentId="+entityId+"&attributeValue=" + this.checked + "&envoi=" + envoi,
					        dataType: "json",
					        success: function(data){
					        	
					        }
				 		});
				 	});
				 	var checkboxCompletTd = $("<td></td>");
				 	checkboxCompletTd.append(checkboxComplet);
				 	row.append(checkboxCompletTd);
				 	
				 	row.append("</tr>");
				});
			   },
			   error:  function(jqXHR, textStatus, errorThrown) {
					if(jqXHR.responseText !== ''){
				        alert(jqXHR.responseText);
				    }else{
				        alert('Une erreur est survenue.');
				    }  
				}
			});
	}
	
	function getPiscines() {
		$.ajax({
	          type: "POST",
	          url: "adherentList.do?action=loadPiscines",
	          dataType: "json",
	          success: function(data){
	       		var select = $("#piscines");
	       		select.empty();
	       		select.append('<option value="-1">Aucune sélection</option>');
	           	$.each(data, function() {
	           		select.append('<option value="' + this + '">' + this + '</option>');
	           	});
	           	select.change(function () {
	           		doSearch();
	           	});
	          }
	      });
	}
  
  </script>
  </head>

  <body>
  <div id="loading" title="Chargement en cours..." style="display:none">
  	<div style="text-align: center; color:#FFFFFF">
  		<img src="img/loader.gif" /><br />Chargement en cours...
  	</div>
  </div>
  <div id="sendEmailPopup" title="Envoyer un e-mail">
  	<div>
  		<form id="formSendEmail" method="post" action=""  enctype="multipart/form-data">
  			<p><label for="all">A destination de tous les adhérents</label><input type="checkbox" id="all" name="sendEmail.all" /></p>
  			<p><label for="sujet">Sujet</label><input type="text" id="sujet" name="sendEmail.sujet" size="50" ></p>
	  		<p><label for="corps">Corps</label><textarea id="corps" name="sendEmail.corps">Corps du message</textarea>
	  		</p>
	  		<button type="button" id="sendEmailSend">Envoyer l'e-mail</button>
  		</form>
  	</div>
  </div>
  <div id="affecterPopup" title="Affecter un groupe et/ou un créneau">
  	<form id="formAffecter">
  		<p><label for="affecterGroupe">Sélectionner un groupe</label>
  			<select id="affecterGroupe" name="affecter.affecterGroupe">
  			</select>
  		</p>
  		
  		<div id="divAffecterCreneau" style="display: none"><label for="affecterCreneau">Sélectionner un créneau</label>
  			<select id="affecterCreneau" name="affecter.affecterCreneau" multiple="multiple" size="10">
  			</select>
  		</div>
  		<input type="hidden" id="affecterAdherent" name="affecter.affecterAdherent" value="-1" />
  		<button type="button" id="affecterAction">Affecter</button>
  	</form>
  </div>
  <img src="img/logo.png" />
  <h1 style="float:right">Adhérents saison sportive 2013-2014</h1>
  <div id="find">
  	<form id="formSearch" method="POST" action="AdherentList.do">
  		<fieldset>
  			<legend>Critères de recherche</legend>
	  		<p><label for="nom">Nom</label><input type="text" id="nom" name="searchNom" size="50" />
	  		<label for="nomMinus">Nom (minusc.)</label><input type="text" id="nomMinus" name="searchNomMinus" size="25" />
	  		<label for="prenom">Prénom</label><input type="text" id="prenom" name="searchPrenom" size="50" />
	  		<label for="email">E-mail</label><input type="text" id="email" name="searchEmail" size="50" />
	  		</p>
	  		<p>
	  		<label for="groupe">Groupe</label><select id="groupe" name="searchGroupe"><option value="-1">Aucune sélection</option></select>
	  		<label for="creneau">Créneau</label><select id="creneau" name="searchCreneau"><option value="">Aucune sélection</option><option value="-2">Sans créneaux</option></select>
	  		<label for="piscines">Piscines</label><select id="piscines" name="searchPiscine"><option value="">Aucune sélection</option></select>
	  		</p>
	  		<input type="checkbox" id="dossier" name="searchDossier" /><label for="dossier">Dossier complet</label>
	  		<input type="checkbox" id="saisie" name="searchSaisie" /><label for="saisie">Inscrit</label>
	  		<input type="checkbox" id="certificat" name="searchCertificat" /><label for="certificat">Certificat</label>
	  		<input type="checkbox" id="paiement" name="searchPaiement" /><label for="paiement">Paiement</label>
	  		<div style="text-align: center">
	  		<button type="button" id="search">Rechercher</button>
	  		</div>
  		</fieldset>
  		
  	</form>
  </div>
  <div id="result" style="">
  <form id="formResult" method="post" action="">
  	<table id="result-table">
  	<thead>
  		<tr>
  			<th><input type="checkbox" name="selectAll" id="selectAll" /></th>
  			<th>N°</th>
  			<th>Nom</th>
  			<th>Prénom</th>
  			<th>Date de naissance</th>
  			<th>E-mail</th>
  			<th>Mot de passe</th>
  			<th>Groupe</th>
  			<th>Créneaux</th>
  			<th>Inscrit le</th>
  			<th>Dossier principal</th>
  			<th>Certificat</th>
  			<th>Paiement</th>
  			<th>Dossier complet</th>
  		</tr>
  	</thead>
  	<tbody id="result-table-body">
  	</tbody>
  </table>
  <div id="actions">
  	<button type="button" id="sendEmail" style="font-size: 0.8em;width:130px; height: 30px">Envoyer un e-mail</button>
  </div>
  </form>
  </div>
  
   <div id="infoPopup" title="Information de l'adhérent">
  	<div>
  		<form id="formInfo" method="post" action="">
  			<div id="info-data">
  			</div>
  		</form>
  	</div>
  </div>
  </body>
</html>