<div class="container" ng-controller="DossierController">
	<div class="row">
		<h1 class="page-header">Suivi des dossiers d'inscriptions</h1>
	</div>
	<div class="row" style="margin-bottom: 1%">
		<span class="badge">{{statistiques.total}}</span> dossiers / <span class="badge">{{statistiques.complets}}</span> dossiers complets / <span class="badge">{{statistiques.nonpayes}}</span> dossiers non payés 
	</div>
	<div class="row">
	   <form class="form-horizontal">
	       <div class="form-group">
	           <input type="text" class="form-control" ng-model="query" />
	       </div>
    	
    	   <div class="form-group">
    	       <div class="form-inline">
    	               <label for="groupe">Groupe</label>
			    	<select class="form-control" id="groupe" ng-model="groupe"
			    	ng-options="groupe.id as groupe.title for groupe in groupes">
					 	<option value="">Choisir un groupe</option>
					</select>
                   <label for="dossierStatut">Statut du dossier</label> 
	                <select class="form-control" id="dossierStatut" name="dossierStatut" ng-model="dossierStatut" ng-options="statut as statut for statut in dossierStatus">
	                   <option value="">Choisir un statut</option>
	                </select>
			   </div>
		    </div>
         </form>
		<button type="button" class="btn btn-block btn-primary" ng-click="search()">Rechercher</button>
		
		<button type="button" class="btn btn-block btn-primary" ng-click="initCreerDossier()">Créer un dossier</button>
		
	</div>
	<div class="row" ng-show="dossiers">
		<p><span class="badge">{{dossierCount}} résultats</span></p>
		<table class="table table-hover">
			<thead>
				<tr>
					<th>Actions</th>
					<th>E-mail</th>
					<th>Code</th>
					<th>Nom</th>
					<th>Prénom</th>
					<th>Date de naissance</th>
					<th>Groupe</th>
					<th>Créneaux</th>
					<th>Etat</th>
					<th>Dernière mise à jour</th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="dossier in dossiers | orderBy:'nom'" ng-class="{'warning': dossier.etat =='PREINSCRIT'}">
					<td>
						<div class="btn-group">
						<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
							<span class="glyphicon glyphicon-edit"></span>
						</button>
						<button type="button" class="btn btn-default" ng-click="displayComment(dossier)" title="Afficher le commentaire" ng-show="dossier.comment">
							<span class="glyphicon glyphicon-comment"></span>
						</button>
						<ul class="dropdown-menu">
							<li><a href="#/dossier/{{dossier.dossierId}}">Modifier</a></li>
							<li ng-hide="dossier.etat == 'INSCRIT'"><a href="" ng-click="relancer(dossier)">Relancer</a></li>
							<li ng-hide="dossier.etat == 'ATTENTE'"><a href="" ng-click="attente(dossier)">Mettre en attente</a></li>
							<li><a href="" ng-click="remove(index, dossier)">Supprimer</a></li>
							<li><a href="" ng-click="removeNageur(index, dossier)">Supprimer dossier du nageur</a></li>
							<li class="divider"></li>
							<li><a href="" ng-click="initPaiement(dossier)" ng-hide="dossier.etat == 'PAIEMENT_COMPLET' || dossier.etat == 'INSCRIT'">Paiement reçu</a></li>
							<li><a href="" ng-click="certificatRecu(dossier)" ng-hide="dossier.nageur.certificat">Certificat reçu</a></li>
							<li><a href="" ng-click="initCommentaire(dossier)">Ajouter un commentaire</a></li>
							<li class="divider"></li>
							<li><a href="" ng-click="changerGroupe(index, dossier)">Changer de groupe</a></li>
							<li><a href="" ng-click="initCreneaux(dossier)">Changer de créneau</a></li>
							<li class="divider"></li>
							<li><a href="/resources/inscription/print/{{dossier.nageur.id}}" download>Bulletin d'adhésion</a></li>
							<li><a href="">Attestation de paiement (en cours...)</a></li>
						</ul>
						</div>
					</td>
					<td>{{dossier.email}}</td>
					<td>{{dossier.motdepasse}}</td>
					<td>{{dossier.nom}}</td>
					<td>{{dossier.prenom}}</td>
					<td>{{dossier.naissance  | date: 'dd/MM/yyyy'}}</td>
					<td>{{dossier.groupe}}</td>
					<td>
						<span ng-repeat="creneau in dossier.creneaux">{{creneau}}<br /></span>
					</td>
					<td>{{dossier.etat}}</td>
					<td>{{dossier.updated | date: 'dd MMM yyyy HH:mm:ss'}}</td>
				</tr>
			</tbody>
		</table>
	</div>

	
	<div ng-include="'views/dossier/groupe.html'"></div>
	<div ng-include="'views/dossier/dossier-creer.html'"></div>
	<div ng-include="'views/dossier/dossier-paiement.html'"></div>
	<div ng-include="'views/dossier/dossier-commentaire.html'"></div>
	<div ng-include="'views/dossier/creneaux.html'"></div>
</div>