<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="pragma" content="no-cache" />
    <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
    <title>ASPTT Grand Toulouse Natation - Inscription 2013-2014</title>
    <link rel="stylesheet" href="css/inscription.css" type="text/css" />
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/start/jquery-ui.css" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    
    <style>
  #dialog label, #dialog input { display:block; }
  #dialog label { margin-top: 0.5em; }
  #dialog input, #dialog textarea { width: 95%; }
  #tabs { margin-top: 1em; }
  #tabs li .ui-icon-close { float: left; margin: 0.4em 0.2em 0 0; cursor: pointer; }
  #add_tab { cursor: pointer; }
  </style>
  
  <script>
  $(function() {
    var tabTitle = $( "#tab_title" ),
      tabContent = $( "#tab_content" ),
      tabTemplate = "<li><a href='#{href}'>#{label}</a> <span class='ui-icon ui-icon-close' role='presentation'>Remove Tab</span></li>",
      tabTemplateContent = $("#contentTemplate").html(),
      tabCounter = 2;
 
    var tabs = $( "#tabs" ).tabs();
 
    // actual addTab function: adds new tab using the input from the form above
    function addTab() {
      var label = "Adhérent " + tabCounter,
        id = "tabs-" + tabCounter,
        li = $( tabTemplate.replace( /#\{href\}/g, "#" + id ).replace( /#\{label\}/g, label ) ),
        tabContentHtml = tabTemplateContent.replace( /#\{tabId\}/g, id + "_" );
      
 
      tabs.find( ".ui-tabs-nav" ).append( li );
      tabs.append( "<div id='" + id + "'></div>" );
      $("#" + id).append(tabContentHtml);
      tabs.tabs( "refresh" );
      tabCounter++;
    }
 
    // addTab button: just opens the dialog
    $( "#add_tab" )
      .button()
      .click(function() {
        addTab();
      });
 
    // close icon: removing the tab on click
    tabs.delegate( "span.ui-icon-close", "click", function() {
      var panelId = $( this ).closest( "li" ).remove().attr( "aria-controls" );
      $( "#" + panelId ).remove();
      tabs.tabs( "refresh" );
    });
 
    tabs.bind( "keyup", function( event ) {
      if ( event.altKey && event.keyCode === $.ui.keyCode.BACKSPACE ) {
        var panelId = tabs.find( ".ui-tabs-active" ).remove().attr( "aria-controls" );
        $( "#" + panelId ).remove();
        tabs.tabs( "refresh" );
      }
    });
	function getGroupes(groupId, tabId) {
		$.ajax({
            type: "POST",
            url: "InscriptionAction.do?action=loadGroupes&groupeId=" + groupId,
            dataType: "json",
            success: function(data){
            		var groupId = data.id;
            		$("#" + tabId + "groupeLegende").append("Saison 2013-2014 Groupe - <span><b>" + data.title + "</b></span>");
            		getCreneaux(tabId, groupId);
            }
        });
	}
	
	function getCreneaux(tabId, groupeId) {
		$.ajax({
            type: "POST",
            url: "InscriptionAction.do?action=loadCreneaux&selectedGroupe=" + groupeId,
            dataType: "json",
            success: function(data){
            	$("#"+tabId+"creneaux").empty();
            	$.each(data, function() {
            		var creneauId = tabId + "creneau" + this.id;
            		$("#"+tabId+"creneaux").css('visibility', 'visible');
            		$("#"+tabId+"creneaux").append('<p><label for=\'' + creneauId + '\'>' + this.swimmingPool + '<br />' + this.dayOfWeek + ' ' + this.beginStr + '-' + this.endStr +'</label><input type=\'checkbox\' id=\'' + creneauId + '\' name=\'' + creneauId + '\' /></p>');
            	});
            }
        });
	}
	$("#valid").button();
	$("#valid").click(function() {
		if(confirm("Etes-vous sûr de l'exactitude des informations fournies ?")) {
			$(this).attr('disabled', 'disabled');
		  $.ajax({type:"POST", data: $("#1_form").serialize(), url:"InscriptionAction.do", 
				success: function(data){
					submitTabs(2);
				},
	                        error: function(){
				        alert('Une erreur est survenue.');
				}
			});
		}
	  });
	$("#valid_find_email").button();
	$("#valid_find_email").click(function() {
		$.ajax({type: "POST", data: $("#formFind").serialize(), url: "InscriptionAction.do?action=findEmail", dataType: "json",
			success: function(data) {
				$.each(data, function(i, elt) {
					var tabId = "tabs-" + (i + 1) + "_";
					var groupeId = tabId;
					if(i == 0) {
						tabId = "1_";
						groupeId = "";
					} else {
						addTab();
					}
				$.each(elt, function(i, el) {
				      var 
				          fel = $("#"+ tabId + "form").find('*[name="' + i + '"]'),
				          type = "", tag = "";

				       if (fel.length > 0) {

				           tag = fel[0].tagName.toLowerCase();

				           if (tag == "select" || tag == "textarea") { //...
				              $(fel).val(el);
				           }
				           else if (tag == "input") {
				              type = $(fel[0]).attr("type");
				               if (type == "text" || type == "password" || type == "hidden" || type == "date") {
				                  fel.val(el);
				               } 
				               else if (type == "checkbox") {
				                  if (el)  
				                     fel.attr("checked", "checked"); 
				               }
				               else if (type == "radio") {
				                   fel.filter('[value="'+el+'"]').attr("checked", "checked"); 
				               }
				           }
				       }
				   });
        		$("#" + groupeId + "groupeLegende").append("Saison 2013-2014 Groupe - <span><b>" + elt.groupEntity.title + "</b></span>");
        		getCreneaux(groupeId, elt.groupEntity.id);
				});
				$("#find").fadeOut(function() {
					$("#adhesion").fadeIn(1000);
				});
			},
			error: function() {
				alert("Une erreur est survenue.");
			}
		})
	});
	$("#valid_find_prenom").button();
	$("#valid_find_prenom").click(function() {
		$.ajax({type: "POST", data: $("#formFind").serialize(), url: "InscriptionAction.do?action=findNomPrenom",
			success: function(data) {
				$("#find").fadeOut(function() {
					$("#adhesion").fadeIn(1000);
				});
			},
			error: function() {
				alert("Une erreur est survenue.");
			}
		})
	});
	
	function submitTabs(index) {
		$.ajax({type:"POST", data: $("#tabs-" + index +"_form").serialize() + "&adherentIndex=" + index, url:"InscriptionAction.do", 
			success: function(data){
				index++;
				if(index  < tabCounter) {
					submitTabs(index);
				} else {
					$("#adhesion").fadeOut(function() {
						$("#result").fadeIn(1000);
						$("#result").append("Inscription terminée");
					});
					$('html, body').animate({ scrollTop: 0 }, 'slow');
				}
			},
                        error: function(){
                        	alert('Une erreur est survenue.');
			}
		});
	}
  });
  
  </script>
  </head>

  <body>
  <h1>Bienvenue sur le module d'inscription pour la saison sportive 2013-2014</h1>
  <div id="find">
  <form id="formFind" method="post" action="InscriptionAction.do">
   <fieldset>
  			<legend>Je m'identifie l'adresse e-mail que j'ai fournie en début d'année</legend>
  			<p>
  				<label for="find_email">Adresse e-mail</label><input type="text" id="find_email" name="find_email" size="50" />
  				<button type="button" id="valid_find_email">Valider</button>
  </p>
  </fieldset>
  <p style="font-weight: bold; font-size: 1.1em; text-align:center">OU</p>
  <fieldset>
  	<legend>Je m'identifie par nom, prénom et ma date de naissance</legend>
  			<p>
  				<label for="find_nom">Nom</label><input type="text" id="find_nom" name="find_nom" size="50" />
  				&nbsp;
  				<label for="find_prenom">Prénom</label><input type="text" id="find_prenom" name="find_prenom" size="50" />
  				&nbsp;
  				<label for="find_dateNaissance">Date de naissance</label><input type="text" id="find_dateNaissance" name="find_dateNaissance" size="50" />
  				<button type="button" id="valid_find_prenom">Valider</button>
  			</p>
  </fieldset>
  </form>
  </div>
  <div id="result" style="display:none">
  </div>
  <div id="adhesion" style="display:none">
  	<form id="1_form" method="post" action="InscriptionAction.do">
  	<input type="hidden" name="action" value="inscription" />
  	<div id="bar">
	<button id="add_tab" type="button">Ajouter un enfant</button>
	<button type="button" id="valid">Valider mon inscription</button>
  		</div>
<div id="tabs">
<ul>
    <li><a href="#tabs-1">1er adhérent</a></li>
     </ul>
     <div id="tabs-1">
  	
  		<fieldset>
  			<legend>Etat civil</legend>
  			<p>
  				<label for="monsieur">Monsieur</label><input type="radio" id="monsieur" name="civilite" value="0" />
  				<label for="madame">Madame</label><input type="radio" id="madame" name="civilite" value="1" />
  				<label for="mademoiselle">Mademoiselle</label><input type="radio" id="mademoiselle" name="civilite" value="2" />
  			</p>
  			<p><label for="nom">Nom</label><input type="text" id="nom" name="nom" size="100" /></p>
  			<p><label for="prenom">Prénom</label><input type="text" name="prenom" id="prenom" size="100" /></p>
  			<p>
  				<label for="dateNaissance">Date de naissance</label><input type="date" id="dateNaissance" name="dateNaissance" />
  				<label for="lieuNaissance">Lieu de naissance</label><input type="text" id="lieuNaissance" name="lieuNaissance" size="50" />
  				<label for="nationalite">Nationalite</label><input type="text" id="nationalite" name="nationalite" size="30" />
  			</p>
  		</fieldset>
  		
  		<fieldset>
  			<legend id="groupeLegende"></legend>
  			<p>Veuillez choisir le créneau pour effectuer un test</p>
  			<div id="creneaux" class="creneaux"></div>
  		</fieldset>
  		
  		<fieldset>
  			<legend>Adresse postale</legend>
  			<p>
  				<label for="adresse">Adresse complète</label><input type="text" id="adresse" name="adresse" size="100" />
  			</p>
  			<p>
  				<label for="codePostal">Code postal</label><input type="text" id="codePostal" name="codePostal" size="10" />
  				<label for="ville">Ville</label><input type="text" id="ville" name="ville" size="50" />
  			</p>
  		</fieldset>
  		
  		<fieldset>
  			<legend>Contact</legend>
  			<p><label for="telephone">Numéro de téléphone principal</label><input type="text" id="telephone" name="telephone" size="15" /></p>
  			<p>
				<label for="telephonePere">Numéro de téléphone père</label><input type="text" id="telephonePere" name="telephonePere" size="15" />
				<label for="telephonePerePro">Numéro de téléphone professionel du père</label><input type="text" id="telephonePerePro" name="telephonePerePro" size="15" />
			</p>
			<p>
				<label for="telephoneMere">Numéro de téléphone mère</label><input type="text" id="telephoneMere" name="telephoneMere" size="15" />
				<label for="telephoneMerePro">Numéro de téléphone professionel du mère</label><input type="text" id="telephoneMerePro" name="telephoneMerePro" size="15" />
			</p>
			<p><label for="email">Adresse e-mail (usuelle pour toutes les communications)</label><input type="text" id="email" name="email" size="50" /></p>
  		</fieldset>
  			
  			<fieldset>
  				<legend>Equipement - mensuration (Taille Arena)</legend>
  				<p>
  					<label for="maillot">Maillot de bain</label><input type="text" id="maillot" name="maillot" size="5" />
  					<label for="tshirt">T-Shirt</label>
	  					<select id="tshirt" name="tshirt">
	  						<option>XS</option>
	  						<option>S</option>
	  						<option>M</option>
	  						<option>L</option>
	  						<option>XL</option>
	  					</select>
  					<label for="shortPantalon">Short</label>
  						<select id="shortPantalon" name="shortPantalon">
  							<option>XS</option>
	  						<option>S</option>
	  						<option>M</option>
	  						<option>L</option>
	  						<option>XL</option>
  						</select>
  				</p>
  			</fieldset>
  		<fieldset>
  			<legend>Fonction dans la section</legend>
  			<p>
  				<label for="adherent">Adhérent(e)</label><input type="checkbox" id="adherent" checked="checked" />
  				<label for="president">Président(e)</label><input type="checkbox" id="president" name="president" />
  				<label for="secretaire">Secrétiaire</label><input type="checkbox" id="secretaire" name="secretaire" />
  				<label for="tresorier">Trésorier(e)</label><input type="checkbox" id="tresorier" name="tresorier" />
  				<label for="bureau">Membre Bureau Section</label><input type="checkbox" id="bureau" name="bureau" />
  				<label for="cadre">Cadre technique</label><input type="checkbox" id="cadre" name="cadre" />
  				<label for="officiel">Arbitre / Officiel</label><input type="checkbox" id="officiel" name="officiel" />
  				<label for="conseil">Membre du conseil administratif ASPTT</label><input type="checkbox" id="conseil" name="conseil" />
  			</p>
  		</fieldset>
  		
  		<fieldset>
  			<legend>Renseignements confidentiels (pour le sponsoring)</legend>
  			<p>
  				<label for="scolaire">Scolaire</label><input type="radio" id="scolaire" name="profession" />
  				<label for="etudiant">Etudiant</label><input type="radio" id="etudiant" name="profession" />
  				<label for="salarie">Salarié</label><input type="radio" id="salarie" name="profession" />
  				<label for="retraite">Retraité</label><input type="radio" id="retraite" name="profession" />
  				<label for="demandeur">Demandeur d'emploi</label><input type="radio" id="demandeur" name="profession" />
  			</p>
  			<p>
  				<label for="professionPere">Profession du père</label><input type="text" id="professionPere" name="professionTextPere" />
  				<label for="professionMere">Profession de la mère</label><input type="text" id="professionMere" name="professionTextMere" />
  			</p>
  		</fieldset>
  		
  		<fieldset>
  			<legend>Accord de licence</legend>
  			<p>
  				<label for="accordNomPrenom">Je, soussigné</label><input type="text" id="accordNomPrenom" name="accordNomPrenom" /> reconnais avoir pris connaissance de la notice d’assurance FS ASPTT:
  			</p>
  		</fieldset>
  		
  		<fieldset>
  			<legend>Autorisation parentale pour les mineurs</legend>
  			<p>
  				<label for="mineurParent">Je, soussigné</label><input type="text" id="mineurParent" name="mineurParent" /><label for="mineur">représentant légal de</label><input type="text" id="mineur" name="mineur" />
  			</p>
  		</fieldset>
  		
  		<fieldset>
  			<legend>Personne à contacter en cas d'accident</legend>
  			<p>
  				<label for="accidentNom1">Nom</label><input type="text" id="accidentNom1" name="accidentNom1" />
  				<label for="accidentPrenom1">Prénom</label><input type="text" id="accidentPrenom1" name="accidentPrenom1" />
  				<label for="accidentTelephone1">Téléphone</label><input type="text" id="accidentTelephone1" name="accidentTelephone1" />
  			</p>
  			<p>
  				<label for="accidentNom2">Nom</label><input type="text" id="accidentNom2" name="accidentNom2" />
  				<label for="accidentPrenom2">Prénom</label><input type="text" id="accidentPrenom2" name="accidentPrenom2" />
  				<label for="accidentTelephone2">Téléphone</label><input type="text" id="accidentTelephone2" name="accidentTelephone2" />
  			</p>
  		</fieldset>
  		</div>
</form>
  		
<div id="contentTemplate" style="display:none">
<form id="#{tabId}form">
<input type="hidden" name="action" value="inscriptionSub" />
<p><label for="#{tabId}supprimer">Pour la saison 2013-2014, je souhaite supprimer cette adhésion</label><input type="checkbox" id="#{tabId}supprimer" name="supprimer" /></p>
<fieldset>
  			<legend>Etat civil</legend>
  			<p>
  				<label for="#{tabId}monsieur">Monsieur</label><input id="#{tabId}monsieur" type="radio" name="civilite" value="0" />
  				<label for="#{tabId}madame">Madame</label><input id="#{tabId}madame" type="radio" name="civilite" value="1" />
  				<label for="#{tabId}mademoiselle">Mademoiselle</label><input id="#{tabId}mademoiselle" type="radio" name="#civilite" value="2" />
  			</p>
  			<p><label for="#{tabId}nom">Nom</label><input type="text" id="#{tabId}nom" name="nom" size="100" /></p>
  			<p><label for="#{tabId}prenom">Prénom</label><input type="text" id="#{tabId}prenom" name="prenom"  size="100" /></p>
  			<p>
  				<label for="#{tabId}dateNaissance">Date de naissance</label><input type="date" id="#{tabId}dateNaissance" name="dateNaissance" />
  				<label for="#{tabId}lieuNaissance">Lieu de naissance</label><input type="text" id="#{tabId}lieuNaissance" name="lieuNaissance" size="50" />
  				<label for="#{tabId}nationalite">Nationalite</label><input type="text" id="#{tabId}nationalite" name="nationalite" size="30" />
  			</p>
  		</fieldset>
  		<fieldset>
  			<legend id="#{tabId}groupeLegende"></legend>
  			<div id="#{tabId}creneaux" class="creneaux"></div>
  			
  		</fieldset>
  			<fieldset>
  				<legend>Equipement - mensuration (Arena)</legend>
  				<p>
  					<label for="#{tabId}maillot">Maillot de bain</label><input type="text" id="#{tabId}maillot" name="maillot" size="5" />
  					<label for="#{tabId}tshirt">T-Shirt</label>
	  					<select id="#{tabId}tshirt" name="tshirt">
	  						<option>XS</option>
	  						<option>S</option>
	  						<option>M</option>
	  						<option>L</option>
	  						<option>XL</option>
	  					</select>
  					<label for="#{tabId}shortPantalon">Short</label>
  						<select id="#{tabId}shortPantalon" name="shortPantalon">
  							<option>XS</option>
	  						<option>S</option>
	  						<option>M</option>
	  						<option>L</option>
	  						<option>XL</option>
  						</select>
  				</p>
  			</fieldset>
  		<fieldset>
  			<legend>Fonction dans la section</legend>
  			<p>
  				<label for="#{tabId}adherent">Adhérent(e)</label><input type="checkbox" id="#{tabId}adherent" name="adherent" checked="checked" />
  				<label for="#{tabId}president">Président(e)</label><input type="checkbox" id="#{tabId}president" name="president" />
  				<label for="#{tabId}secretaire">Secrétiaire</label><input type="checkbox" id="#{tabId}secretaire" name="secretaire" />
  				<label for="#{tabId}tresorier">Trésorier(e)</label><input type="checkbox" id="#{tabId}tresorier" name="tresorier" />
  				<label for="#{tabId}bureau">Membre Bureau Section</label><input type="checkbox" id="#{tabId}bureau" name="bureau" />
  				<label for="#{tabId}cadre">Cadre technique</label><input type="checkbox" id="#{tabId}cadre" name="cadre" />
  				<label for="#{tabId}officiel">Arbitre / Officiel</label><input type="checkbox" id="#{tabId}officiel" name="officiel" />
  				<label for="#{tabId}conseil">Membre du conseil administratif ASPTT</label><input type="checkbox" id="#{tabId}conseil" name="conseil" />
  			</p>
  		</fieldset>
  		
  		<fieldset>
  			<legend>Renseignements confidentiels et facultatifs</legend>
  			<p>
  				<label for="#{tabId}scolaire">Scolaire</label><input type="radio" id="#{tabId}scolaire" name="#{tabId}profession" />
  				<label for="#{tabId}etudiant">Etudiant</label><input type="radio" id="#{tabId}etudiant" name="#{tabId}profession" />
  				<label for="#{tabId}salarie">Salarié</label><input type="radio" id="#{tabId}salarie" name="#{tabId}profession" />
  				<label for="#{tabId}retraite">Retraité</label><input type="radio" id="#{tabId}retraite" name="#{tabId}profession" />
  				<label for="#{tabId}demandeur">Demandeur d'emploi</label><input type="radio" id="#{tabId}demandeur" name="#{tabId}profession" />
  			</p>
  		</fieldset>
  		
  		<fieldset>
  			<legend>Autorisation parentale pour les mineurs</legend>
  			<p>
  				<label for="#{tabId}mineurParent">Je, soussigné</label><input type="text" id="#{tabId}mineurParent" name="mineurParent" /><label for="#{tabId}mineur">représentant légal de</label><input type="text" id="#{tabId}mineur" name="mineur" />
  			</p>
  		</fieldset>
  		</form>
</div>
</div>
</div>
  </body>
</html>